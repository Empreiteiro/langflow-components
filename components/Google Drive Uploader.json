{"data":{"edges":[],"nodes":[{"data":{"node":{"template":{"_type":"Component","service_account_json":{"trace_as_metadata":true,"file_path":"","fileTypes":["json"],"temp_file":false,"list":false,"list_add_label":"Add More","required":true,"placeholder":"","show":true,"name":"service_account_json","value":"","display_name":"GCP Credentials JSON File","advanced":false,"dynamic":false,"info":"Upload your Google Cloud Platform service account JSON key.","title_case":false,"type":"file","_input_type":"FileInput","load_from_db":false},"code":{"type":"code","required":true,"placeholder":"","list":false,"show":true,"multiline":true,"value":"from langflow.custom import Component\nfrom langflow.io import StrInput, FileInput, MultilineInput, DropdownInput, Output\nfrom langflow.schema import Data\nfrom googleapiclient.discovery import build\nfrom googleapiclient.http import MediaFileUpload\nfrom google.oauth2 import service_account\nimport os\nimport base64\nimport json\n\nclass GoogleDriveUploader(Component):\n    display_name = \"Google Drive Uploader\"\n    description = \"Uploads a file to a specified Google Drive folder.\"\n    icon = \"Google\"\n    name = \"GoogleDriveUploader\"\n\n    FILE_TYPE_CHOICES = [\"jpg\", \"txt\", \"json\", \"mp3\"]\n\n    inputs = [\n        MultilineInput(\n            name=\"file_content\",\n            display_name=\"File Content\",\n            info=\"The content of the file to be saved and uploaded.\",\n            required=True,\n        ),\n        StrInput(\n            name=\"file_name\",\n            display_name=\"File Name\",\n            info=\"The name of the file to be saved (without extension).\",\n            required=True,\n        ),\n        DropdownInput(\n            name=\"file_type\",\n            display_name=\"File Type\",\n            options=FILE_TYPE_CHOICES,\n            info=\"Select the type of the file (jpg, txt, json).\",\n            required=True,\n        ),\n        StrInput(\n            name=\"folder_id\",\n            display_name=\"Destination Folder ID\",\n            info=\"The Google Drive folder ID where the file will be uploaded. The folder must be shared with the service account email.\",\n            required=True,\n        ),\n        FileInput(\n            name=\"service_account_json\",\n            display_name=\"GCP Credentials JSON File\",\n            file_types=[\"json\"],\n            info=\"Upload your Google Cloud Platform service account JSON key.\",\n            required=True,\n        ),\n    ]\n\n    outputs = [\n        Output(name=\"file_url\", display_name=\"File URL\", method=\"upload_file\"),\n    ]\n\n    def upload_file(self) -> Data:\n        \"\"\"Saves file based on its type and uploads it to Google Drive.\"\"\"\n        try:\n            file_path = f\"{self.file_name}\"\n            mime_type = \"\"\n\n            if self.file_type == \"jpg\":\n                file_path += \".jpg\"\n                mime_type = \"image/jpeg\"\n                file_data = base64.b64decode(self.file_content)\n            elif self.file_type == \"txt\":\n                file_path += \".txt\"\n                mime_type = \"text/plain\"\n                file_data = self.file_content.encode(\"utf-8\")\n            elif self.file_type == \"json\":\n                file_path += \".json\"\n                mime_type = \"application/json\"\n                file_data = json.dumps(json.loads(self.file_content), indent=4).encode(\"utf-8\")\n            elif self.file_type == \"mp3\":\n                file_path += \".mp3\"\n                mime_type = \"audio/mpeg\"\n                file_data = self.file_content  # Aqui os dados já vêm como bytes do ElevenLabs\n                if isinstance(file_data, str):\n                    raise ValueError(\"Audio data must be passed as bytes, not string.\")\n\n            else:\n                raise ValueError(\"Unsupported file type.\")\n\n            with open(file_path, \"wb\") as file:\n                file.write(file_data)\n\n            with open(self.service_account_json, \"r\", encoding=\"utf-8\") as f:\n                credentials_dict = json.load(f)\n\n            credentials = service_account.Credentials.from_service_account_info(\n                credentials_dict, scopes=[\"https://www.googleapis.com/auth/drive.file\"]\n            )\n            service = build(\"drive\", \"v3\", credentials=credentials)\n\n            file_metadata = {\"name\": os.path.basename(file_path), \"parents\": [self.folder_id]}\n            media = MediaFileUpload(file_path, mimetype=mime_type, resumable=True)\n            \n            file = (\n                service.files()\n                .create(body=file_metadata, media_body=media, fields=\"id\")\n                .execute()\n            )\n            file_id = file.get(\"id\")\n            file_url = f\"https://drive.google.com/file/d/{file_id}/view\"\n\n            os.remove(file_path)\n\n            return Data(data={\"file_url\": file_url})\n        except Exception as e:\n            self.log(f\"Error uploading file: {e}\")\n            return Data(data={\"error\": str(e)})\n","fileTypes":[],"file_path":"","password":false,"name":"code","advanced":true,"dynamic":true,"info":"","load_from_db":false,"title_case":false},"file_content":{"tool_mode":false,"trace_as_input":true,"multiline":true,"trace_as_metadata":true,"load_from_db":false,"list":false,"list_add_label":"Add More","required":true,"placeholder":"","show":true,"name":"file_content","value":"","display_name":"File Content","advanced":false,"input_types":["Message"],"dynamic":false,"info":"The content of the file to be saved and uploaded.","title_case":false,"copy_field":false,"type":"str","_input_type":"MultilineInput"},"file_name":{"tool_mode":false,"trace_as_metadata":true,"load_from_db":false,"list":false,"list_add_label":"Add More","required":true,"placeholder":"","show":true,"name":"file_name","value":"eleven","display_name":"File Name","advanced":false,"dynamic":false,"info":"The name of the file to be saved (without extension).","title_case":false,"type":"str","_input_type":"StrInput"},"file_type":{"tool_mode":false,"trace_as_metadata":true,"options":["jpg","txt","json","mp3"],"options_metadata":[],"combobox":false,"dialog_inputs":{},"toggle":false,"required":true,"placeholder":"","show":true,"name":"file_type","value":"jpg","display_name":"File Type","advanced":false,"dynamic":false,"info":"Select the type of the file (jpg, txt, json).","title_case":false,"type":"str","_input_type":"DropdownInput","load_from_db":false},"folder_id":{"tool_mode":false,"trace_as_metadata":true,"load_from_db":false,"list":false,"list_add_label":"Add More","required":true,"placeholder":"","show":true,"name":"folder_id","value":"1LkUg0JiitBLFWTDnRFWZzU7wDNuYerpo","display_name":"Destination Folder ID","advanced":false,"dynamic":false,"info":"The Google Drive folder ID where the file will be uploaded. The folder must be shared with the service account email.","title_case":false,"type":"str","_input_type":"StrInput"}},"description":"Uploads a file to a specified Google Drive folder.","icon":"Google","base_classes":["Data"],"display_name":"Google Drive Uploader","documentation":"","minimized":false,"custom_fields":{},"output_types":[],"pinned":false,"conditional_paths":[],"frozen":false,"outputs":[{"types":["Data"],"selected":"Data","name":"file_url","hidden":null,"display_name":"File URL","method":"upload_file","value":"__UNDEFINED__","cache":true,"required_inputs":null,"allows_loop":false,"options":null,"tool_mode":true}],"field_order":["file_content","file_name","file_type","folder_id","service_account_json"],"beta":false,"legacy":false,"edited":true,"metadata":{},"tool_mode":false,"official":false},"showNode":true,"type":"GoogleDriveUploader","id":"GoogleDriveUploader-NCFwy"},"id":"GoogleDriveUploader-NCFwy","position":{"x":0,"y":0},"type":"genericNode"}],"viewport":{"x":1,"y":1,"zoom":1}},"description":"Uploads a file to a specified Google Drive folder.","name":"Google Drive Uploader","id":"GoogleDriveUploader-NCFwy","is_component":true,"last_tested_version":"1.3.4"}